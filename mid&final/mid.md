# C4-compiler 

## C4編譯器簡介
* C4是小型的C語言編譯器，使用4個函數所寫，完整名稱為 C in 4 function
* 具備詞法分析、語法分析、簡單的語義檢查、代碼生成、執行環境
* Q : c4 編譯器    
```
CharGPT:
C4 編譯器是一個開源的編譯器，用於將 C 語言代碼編譯成機器碼或中間表示形式。C4 編譯器主要由優化技術、代碼生成和中間表示等組件組成，旨在提供高效的編譯過程。

C4 編譯器的目標是產生高效的機器碼，並且提供可擴展性，使其能夠在多種不同的硬件和操作系統上運行。它的設計也注重易於理解和擴展，使開發人員能夠輕鬆地對其進行修改和改進。

C4 編譯器可能包含以下主要組件：
1.前端（Frontend）：負責解析和分析 C 語言的語法和語義，進行語法檢查和類型檢查。它還將 C 語言代碼轉換成中間表示形式，以便後續的優化和代碼生成。
2.優化器（Optimizer）：對中間表示形式進行優化，以改進代碼的效能和質量。這包括常見的優化技術，如死代碼刪除、循環展開、函數內聯等。
3.代碼生成器（Code Generator）：將優化後的中間表示形式轉換為目標機器碼。代碼生成器需要考慮目標硬件的體系結構和指令集架構，並生成相應的機器指令序列。

C4 編譯器的具體實現可能因編譯器版本和使用的技術而有所不同。它可能會使用現代編譯器設計中常見的技術，如語法分析器生成器、中間表示形式、基於圖的優化等。

需要注意的是，這裡提到的 C4 編譯器僅是一個示例，實際存在的 C 語言編譯器有很多種，如 GNU GCC、LLVM Clang 等，它們都具有不同的特點和用途。
```

## C4簡易流程

* Q : C4 編譯器 簡易步驟
```
ChatGPT:
以下是一個簡單的步驟概述，用於解釋 C4 編譯器的基本運作流程：

1.語法分析：C4 編譯器首先會對輸入的 C 語言代碼進行語法分析，這是通過解析器（Parser）來完成的。解析器會檢查代碼的結構是否符合 C 語言的語法規則，並將代碼轉換成內部表示形式，如抽象語法樹（Abstract Syntax Tree）或其他中間表示。
2.語義分析：在語法分析後，編譯器會進行語義分析，這是為了確保代碼的語義（含義）是正確的。語義分析器（Semantic Analyzer）會檢查變量的聲明和使用是否匹配，類型是否正確等。它還會檢查代碼中的錯誤或不一致之處，並生成相關的錯誤報告。
3.優化：在語義分析後，編譯器可以進行一系列的優化步驟，以改進代碼的效能和質量。這些優化步驟可以包括常量折疊、死代碼刪除、循環展開等。優化器（Optimizer）會對內部表示形式進行分析和轉換，以應用這些優化技術。
4.代碼生成：優化完成後，編譯器將生成目標機器碼或目標表示形式。代碼生成器（Code Generator）負責將內部表示形式轉換為目標機器碼或中間表示，這取決於具體的編譯器設計。代碼生成器需要考慮目標硬件的體系結構和指令集架構，以生成對應的機器指令序列。
5.鏈接：最後，生成的目標機器碼可能需要進行鏈接（Linking），以將其與其他代碼模塊進行結合，以生成最終可執行程序或庫文件。

需要注意的是，這只是簡單概述了 C4 編譯器的基本步驟。實際的編譯器實現可能會更加複雜，涉及更多的步驟和技術，以提供更高效和全面的編譯功能。
```

* C4-flowchart
![C4-flowchart](https://hackmd.io/_uploads/S1yEmNdD2.jpg)

## 特色&語法

* 本身就是編譯器
* 整數、字串、指標、整數及字串的指標
* if-else、while
* enum (列舉)
* function
* return
* 運算符號 + - * / ......
* Q : C4 編譯器 無法使用的型態
```
ChatGPT:
C4 編譯器可能會限制或不支援某些型態或特定的功能，這可能取決於該編譯器的設計和實現。以下是一些可能無法使用的型態的示例：

1.非標準的數據型態：C4 編譯器可能只支援標準的數據型態，如整數型態（int）、浮點數型態（float）、字符型態（char）等。非標準的或特定平台的數據型態可能無法被該編譯器所識別和使用。
2.复数型態：某些編譯器可能不直接支援复数型態，這是一種表示虛數和實數部分的數據型態。在這種情況下，開發人員可能需要使用其他數學庫或手動實現相關的操作。
3.高精度數據型態：某些編譯器可能不提供內建的高精度數據型態，如大整數（BigInteger）或任意精度浮點數（BigDecimal）。在需要處理非常大或非常精確的數字時，開發人員可能需要使用專門的數學庫或自行實現。
4.自定義型態：如果C4編譯器不支援自定義的型態，開發人員將無法聲明和使用自己定義的型態。這可能會限制某些特定領域或項目的開發需求。

需要注意的是，這些限制可能因不同的編譯器而異。如果有特定的需求或型態需要使用，建議查閱相關編譯器的文檔或官方資源，以瞭解其所支援的功能和型態。在某些情況下，開發人員可能需要考慮使用其他編譯器或額外的庫來滿足特定的需求。
```

## C4中的虛擬機

* 控制碼

| 控制碼 | 控制碼全名 | 意義 |
| -------- | -------- | -------- |
| LEA | Load Effective Address | 載入區域變數 |
| IMM | Immediate Value | 載入全域變數或立即值 |
| JMP | Jump | 跳躍 |
| JSR | Jump To SubRoutine | 跳到副程式 |
| BZ | Branch if Zero | 為0時跳到X |
| BNZ | Branch if Not Zero | 不為0時跳到X |
| ENT | Enter SubRoutine | 進入副程式 |
| ADJ | Stack Adjust | 調整堆疊 |
| LEV | Leave SubRoutine | 離開副程式 |
| LI | Load INT | 載入整數 |
| LC | Load CHAR | 載入字元 |
| SI | Store INT | 儲存整數 |
| SC | Store CHAR | 儲存字元 |
| PSH | Push Into Stack Frame | 推入堆疊 |
| OR |  | 或 |
| XOR | Exclusive OR | 互斥或 |
| AND |  | 同時有 |
| EQ | Equal | 等於 |
| NE | Not Equal to | 不等於 |
| LT | Less Then | 小於 |
| GT | Greater Then | 大於 |
| LE | Less then or Equal to | 小於等於 |
| GE | Greater then or Equal to | 大於等於 |
| SHL | Shift Left | 邏輯左移 |
| SHR | Shift Right | 邏輯右移 |
| ADD | Addtion | 加法 |
| SUB | Subtration | 減法 |
| MUL | Multiplication | 乘法 |
| DIV | division | 除法 |
| MOD | modulo | 取餘數 |
| EXIT | Exit Program | 終止離開 |


## C4 衍生
* 擴充jit，使其效能提升
* Q : C4 編譯器的衍生功能 請舉例
```
ChatGPT:
C4 編譯器的衍生功能可以根據具體的需求和使用場景而有所不同。以下是一些可能的C4編譯器的衍生功能的示例：

1.多平台支援：C4編譯器的衍生版本可能進行擴展，以支援多種不同的硬件平台和操作系統。例如，衍生版本可能添加對嵌入式系統、ARM架構、GPU等特定平台的支援。
2.優化增強：衍生版本的C4編譯器可能進行更進一步的優化，以提供更高的代碼執行效能。例如，它可能實現更高級的優化技術，如向量化優化、多線程優化等，以利用現代硬件的並行性。
3.垃圾回收支援：C4編譯器的衍生版本可能添加垃圾回收（Garbage Collection）支援，以自動管理動態分配的內存。這將有助於減輕開發人員對內存管理的負擔。
4.語言擴展：衍生版本的C4編譯器可能添加對其他語言特性或擴展的支援。例如，它可以支援對C語言的某些限制進行擴展，以提供更高級的語言特性，如匿名函數、泛型編程等。
5.集成開發環境（IDE）支援：衍生版本的C4編譯器可能與IDE集成，提供更便捷的開發環境。這可以包括語法高亮、代碼補全、語義錯誤檢測等功能，以提高開發效率。

需要注意的是，這些衍生功能的可行性和實現方式可能取決於具體的項目和開發者的需求。衍生版本的C4編譯器可能會在原始版本的基礎上進行修改和擴展，以滿足特定的需求。
```

## 參考資料

[C4 -- 500 行的 C 語言編譯器](https://github.com/ccc111b/cpu2os/tree/master/A4-%E5%8F%83%E8%80%83%E5%B0%88%E6%A1%88/compiler/c4)    
[C in four function (c4) Compiler](https://hackmd.io/@srhuang/Bkk2eY5ES)    
[C4：4个函数，528行代码实现可自举的 C语言编译器](https://blog.csdn.net/pyf09/article/details/113769048)

* [HackMD連結](https://hackmd.io/@LSX-0123/BkqzXV_v2)